<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To To-Do - Login</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <noscript>
        <div class="error message">
          We're sorry but our site <strong>requires</strong> JavaScript.
          <p>Please check your settings if js is disabled</p>
        </div>    
      </noscript>
  
  
      <div class="container">
          <div class="row h-100 justify-content-md-center">
              <div class="col col-12 col-sm-8 col-lg-6 my-auto">
                  <div class="form-container">
                      <div class="to-to_do">
                          <div class="logo">
                            <svg width="25" height="25" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g clip-path="url(#clip0_317_2)">
                                <path d="M49.0248 493.28C47.3048 490.936 52.2728 474.304 53.2808 473.112C79.4488 442.648 80.4088 344.632 79.8728 330.664C78.5608 298.424 95.6488 265.816 110.065 272.864C123.985 279.664 134.897 346.704 137.577 360.12C144.193 392.928 141.601 432.2 130.977 463.304C119.761 496.24 76.4088 529.664 49.0248 493.28ZM463.801 493.28C465.513 490.936 460.553 474.304 459.537 473.112C433.369 442.648 432.417 344.632 432.953 330.664C434.257 298.424 417.169 265.816 402.753 272.864C388.841 279.664 377.929 346.704 375.249 360.12C368.633 392.928 371.225 432.2 381.849 463.304C393.057 496.24 436.409 529.664 463.801 493.28Z" fill="#3590D2"/>
                                <path d="M19.3686 138.672C36.6486 155.96 77.3286 143.256 110.305 110.272C143.265 77.3118 155.969 36.6478 138.689 19.3518C121.449 2.12783 52.1766 -13.7602 19.2006 19.1998C-13.7594 52.1598 2.12856 121.448 19.3686 138.672ZM491.361 138.672C474.089 155.96 433.409 143.256 400.433 110.272C367.473 77.3118 354.769 36.6478 372.041 19.3518C389.289 2.12783 458.553 -13.7602 491.529 19.1998C524.489 52.1598 508.601 121.448 491.361 138.672Z" fill="#3590D2"/>
                                <path d="M486.472 264.56C486.472 392.392 382.872 496.016 255.032 496.016C127.192 496.016 23.584 392.4 23.584 264.56C23.584 136.752 127.184 47.7598 255.024 47.7598C382.864 47.7598 486.472 136.744 486.472 264.56Z" fill="#3050CF"/>
                                <path d="M428.24 266.4C428.24 362.088 350.688 439.648 254.992 439.648C159.296 439.648 81.7441 362.088 81.7441 266.4C81.7441 170.736 159.304 104.136 254.992 104.136C350.68 104.136 428.24 170.736 428.24 266.4Z" fill="#E7E6E6"/>
                                <path d="M276.44 281.04C276.44 295.088 265.28 306.448 251.504 306.448C237.728 306.448 226.568 295.088 226.568 281.04V161.632C226.568 147.624 237.728 136.264 251.504 136.264C265.288 136.264 276.44 147.624 276.44 161.632V281.04Z" fill="#242765"/>
                                <path d="M253.001 306.48C238.377 306.48 226.561 298.736 226.561 289.192C226.561 279.672 238.377 271.936 253.001 271.936H377.457C392.073 271.936 403.921 279.672 403.921 289.192C403.921 298.736 392.081 306.48 377.457 306.48H253.001Z" fill="#242765"/>
                                </g>
                                <defs>
                                <clipPath id="clip0_317_2">
                                <rect width="512" height="512" fill="white"/>
                                </clipPath>
                                </defs>
                            </svg>
                          </div>
                          <div class="text-center txt">
                              <h2><strong>To To-Do</strong></h2>
                          </div>
                      </div>

                      <img src="assets/images/login image.svg" alt="" srcset="">
                      <center><p>Login to avail the services we offer!</p></center>
                      <div id="login">
                        <center><button>Login with Google</button></center>
                      </div>
  
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- Setting up Firebase -->
    <script type="module">
        
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyA0oxxtXWak689s11Z6C9F6Z6iZI_imNaU",
        authDomain: "to-to-do-22eec.firebaseapp.com",
        projectId: "to-to-do-22eec",
        storageBucket: "to-to-do-22eec.appspot.com",
        messagingSenderId: "350532709206",
        appId: "1:350532709206:web:51c045c9bd1690468284f7"
    };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        // const database = getDatabase(app);
        const auth = getAuth();
        auth.languageCode = 'it';
        console.log("Firebase initialised");
        const provider = new GoogleAuthProvider();

        login.addEventListener('click', (e) => {

            signInWithPopup(auth, provider)
                .then((result) => {
                    // This gives you a Google Access Token. You can use it to access the Google API.
                    const credential = GoogleAuthProvider.credentialFromResult(result);
                    const token = credential.accessToken;

                    // The signed-in user info.
                    // const user = result.user;
                    // alert(user.displayName+' has logged in!');

                    window.location.replace("index1.html");
                }).catch((error) => {
                    // Handle Errors here.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // The email of the user's account used.
                    const email = error.customData.email;
                    // The AuthCredential type that was used.
                    const credential = GoogleAuthProvider.credentialFromError(error);
                    // alert(errorMessage);
                    console.log("ERROR signing in.");
                });

        });

        const user = auth.currentUser;
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, see docs for a list of available properties
                // https://firebase.google.com/docs/reference/js/firebase.User
                const uid = user.uid;
                // User is already signed in, so redirect to the main page.
                window.location.replace("index1.html");
                // ...
            } else {
                // User is signed out
            }
        });
      </script>
</body>
</html>